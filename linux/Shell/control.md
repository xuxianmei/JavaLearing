
除了实时模式在命令行界面上直接运行，还可以通过其他方法用来运行脚本 。
另外还有一些选项能够用于控制脚本。
向脚本发送信号、修改脚本的优先级、在脚本运行时切换到运行模式。

# 处理信号
Linux利用信号与运行在系统听进程进行通信。
可以通过对脚本进行编程，使其收到特定理执行某些命令，
从而控制shell脚本的操作。


Linux系统和应用程序可以生成超过30个信号。

Linxu编程中常见的Linux系统信号：

Linux信号

信号|值|描述
---|---|---
1|SIGHUP|挂起进程
2|SIGINT|终止进程
3|SIGQUIT|停止进程
9|SIGKILL|无条件终止进程
15|SIGTERM|尽可能终止进程
17|SIGSTOP|无条件停止进程，但不是终止进程
18|SIGTSTP|停止或暂停进程，但不终止进程
19|SIGCONT|继续运行停止的进程

shell会将这些信号传给shell脚本程序来处理，而shell脚本的默认行为是忽略这些信号（部分不忽略，比如：1，2）。

可以在脚本中加入识别信号的代码，并执行命令来处理信号。

## 生成信号

bash shell允许用键盘上的组合键生成两种基本的Linux信号。

### 中断进程
CTRL+C 生成 SIGINT信号，并将其发送给当前在shell中运行的所有进程。

### 暂停进程
CTRL+Z生成SIGTSTP信号，停止shell中运行的任何进程。
停止(stopping)进程和终止(terminating)进程不同:
停止进程会让程序继续保存在内存中，并能从上次停止的位置继续运行。

## 捕获信号

```
trap commands signals
```

## 捕获并退出

```
trap commands signals EXIT
```

注：可以在脚本中，对同一个信号进行式次捕获，进行修改脚本捕获信号后的行为。

# 以后台模式运行脚本

```
脚本  &
```
每次启动新作业时，Linux系统都会为其分配一个新的作业号和PID。可以通过ps查看。

注：每一个后台进程都和前台进程联系在一起，如果前台进程退出，那么后台进程也会一起退出。
对于后台模式运行的shell脚本来说，当前shell会话进程，就是其前台进程。

# 在非控制台下运行脚本
如果希望运行在后台模式的脚本在登录控制台后，能继续运行，可以使用nohup命令来实现。


```
nohup 脚本 &
```
由于nohup命令会解除终端与进程的关联，进程也就不再两只STDOUT和STDERR联系在一起。
为了保存该命令产生的输出，nohup自动将STDOUT和STDERR的重定向到一个名为nohup.out的文件中。

# 作业控制

启动、停止、终止以及恢复作业的这些功能统称为作业控制。

通过作业控制，就能完全控制shell环境中所有进程的运行方式了。

注：脚本用$$变量来存在分配给该脚本的PID。
## 查看作业

```
jobs
```

## 重启停止的作业

```
bg 作业号
```

# 调整优先级

```
nice
renice
```

# 定时运行作业

* at命令
* cron表

## 用at命令来计划执行作业
at命令允许指定Linux系统何时运行脚本。
at命令将作业提交到队列中，指定shell何时运行该作业。
at的守护进程atd会以后台模式运行。

默认情况下，atd守护进程会每60秒检查/var/spool/at来获取用at命令提交的作业。
1. at命令的格式

```
at [-f filename] time
```

2. atq 显示有哪些作业在等待

## cron时间表
at命令一般只能计划脚本的一次执行。
而cron程序可以用来安排要定期执行的作业。
cron程序会在后台运行，并检查一个特殊的表，以获知已安排执行的作业

1. cron时间表
格式：
```
min hour daofmonth month dayofweek command
```
cron时间表允许使用确定值、取值范围、通配符来指定。

2. 构建cron时间表
每个系统用户都可以用自己的cron时间表来运行安排好的任务。
查看cron时间表：
```
crontab -l
```
添加计划项
```
crontab -e
```

3. cron目录
```
/etc/cron.*ly
```
如果你创建的脚本对精确的执行时间要求不高，用预配置的cron脚本目录会更方便。
有4个基本目录：hourly、daily、monthly、weekly。
分别代表每小时，每天，每月，每周来执行一次脚本。

4. anacron程序
如果某个作业在cron时间表中安排运行的时间已到，但Linux系统处于关机状态，那么在下次开机
后，这个作业不会被运行。

如果aracron知道某个作业错过了执行时间，它会在开机后，尽快执行该作业。

anacron程序只会处理位于cron目录的程序，它用时间戳来决定作业是否在正确的计划间隔内运行了。

anacron程序使用自己的时间表（位于/etc/anacrontab)来检查作业目录。

