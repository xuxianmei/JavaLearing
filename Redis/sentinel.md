# 哨兵（Redis Sentinel）

## 基本概念

## 主从复制的问题

Redis的主从复制模式可以将主节点的数据改变同步给从节点，这样从
节点就可以起到两个作用：
第一，作为主节点的一个备份，一旦主节点出了故障不可达的情况，从节点可以作为后备“顶”上
来，并且保证数据尽量不丢失（主从复制是最终一致性）。
第二，从节点可以扩展主节点的读能力，一旦主节点不能支撑住大并发量的读操作，从节点可以在
一定程度上帮助主节点分担读压力。

但是主从复制也带来了以下问题：

* 一旦主节点出现故障，需要手动将一个从节点晋升为主节点，同时需
要修改应用方的主节点地址，还需要命令其他从节点去复制新的主节点，整
个过程都需要人工干预。

* 主节点的写能力受到单机的限制。

* 主节点的存储能力受到单机的限制。
其中第一个问题就是Redis的高可用问题。
第二、三个问题属于Redis的分布式问题。

## Redis Sentinel的高可用性
Redis Sentinel正是用于解决主从关系维护，和主从节点之间的故障转移的。
当主节点出现故障时，Redis Sentinel能自动完成故障发现和故障转移，
并通知应用方，从而实现真正的高可用。

Redis Sentinel是一个分布式架构，其中包含若干个Sentinel节点和Redis数据节点，
每个Sentinel节点会对数据节点和其余Sentinel节点进行监控，当它发现节点不可达时，
会对节点做下线标识。
如果被标识的是主节点，它还会和其他Sentinel节点进行“协商”，当大多数Sentinel节点
都认为主节点不可达时，它们会选举出一个Sentinel节点来完成自动故障转移的工作，同时
会将这个变化实时通知给Redis应用方。整个过程完全是自动的，不需要人工来介入，
所以这套方案很有效地解决了Redis的高可用问题。

注：这里的分布式是指：Redis数据节点、Sentinel节点集合、客户端分布在
多个物理节点的架构。
Redis Sentinel与Redis主从复制模式只是多了若干Sentinel
节点，所以Redis Sentinel并没有针对Redis节点做了特殊处理。

![](./images/9-6.png)

Sentinel节点本身就是独立的Redis节点，只不过它们有一些特殊，
它们不存储数据，只支持部分命令。

## 安装与部署

## 客户端连接

## 实现原理